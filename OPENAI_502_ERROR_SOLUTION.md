# Решение проблемы "Run завершился со статусом: failed" в OpenAI

## Описание проблемы

При отправке файлов в Telegram бот и запросе на анализ текста с ассистентом OpenAI, система возвращает ошибку:

```
[Nest] WARN [OpenAiService] Run завершился со статусом: failed
[Nest] WARN [OpenAiService] Попытка 1 не удалась, повторяем через 1000ms
[Nest] WARN [OpenAiService] Error: Run завершился со статусом: failed
```

## Причины ошибки

1. **Проблемы с форматом файла**: Некоторые форматы файлов могут не поддерживаться OpenAI API
2. **Размер файла**: Файлы больше 100MB не поддерживаются
3. **Проблемы с API**: Сетевые проблемы или недоступность OpenAI API
4. **Проблемы с ассистентом**: Ассистент может быть недоступен или иметь ограничения

## Внесенные улучшения

### 1. Детальное логирование

Добавлено детальное логирование для Run операций:
- Логирование размера и формата файла
- Логирование процесса загрузки файла
- Детальная информация об ошибках Run

### 2. Улучшенная обработка ошибок

- Получение детальной информации об ошибке через `getRunErrorDetails`
- Более информативные сообщения об ошибках для пользователя
- Специфичные сообщения для разных типов ошибок

### 3. Валидация файлов в Telegram

- Проверка размера файла (максимум 100MB)
- Проверка поддерживаемых форматов
- Предварительная валидация перед отправкой в OpenAI

## Поддерживаемые форматы файлов

- `.pdf` - PDF документы
- `.txt` - Текстовые файлы
- `.docx` - Word документы (новые)
- `.doc` - Word документы (старые)
- `.rtf` - Rich Text Format
- `.odt` - OpenDocument Text

## Как использовать

1. **Отправьте файл** в Telegram бот
2. **Добавьте описание** в подпись к файлу (опционально)
3. **Дождитесь ответа** от ассистента

## Диагностика проблем

### Проверка логов

При возникновении ошибки проверьте логи на наличие:
- Размера и формата файла
- Процесса загрузки в OpenAI
- Детальной информации об ошибке Run

### Проверка API

Убедитесь, что:
- OpenAI API доступен
- API ключ корректный
- Нет сетевых проблем

### Проверка файла

Убедитесь, что:
- Файл не поврежден
- Размер в пределах лимитов
- Формат поддерживается

## Примеры ошибок и решений

### Ошибка: "Run failed: file_size_exceeded"
**Решение**: Уменьшите размер файла или используйте другой формат

### Ошибка: "Run failed: unsupported_file_type"
**Решение**: Конвертируйте файл в поддерживаемый формат

### Ошибка: "Run failed: assistant_unavailable"
**Решение**: Проверьте доступность ассистента в OpenAI

## Контакты для поддержки

При возникновении проблем обратитесь к администратору системы или создайте issue в репозитории проекта.
